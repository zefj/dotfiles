# Prefix
unbind C-b
set -g prefix C-e
bind C-e send-prefix

# General
set -g default-terminal "tmux-256color"
set -g default-shell "/bin/zsh"
set -g default-command "zsh -l"
set -ag terminal-overrides ",xterm-kitty:RGB"
set -s extended-keys always
set -s extended-keys-format csi-u
set -as terminal-features ',xterm-kitty:extkeys'
set -g mouse on
set -g history-limit 50000
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g set-clipboard on
set -sg escape-time 0
set -g focus-events on
set -g detach-on-destroy off

# Splits
bind i split-window -vb -c "#{pane_current_path}"
bind k split-window -v -c "#{pane_current_path}"
bind j split-window -hb -c "#{pane_current_path}"
bind l split-window -h -c "#{pane_current_path}"
unbind '"'
unbind %
unbind |
unbind -

# Windows
bind t command-prompt -p "Create new window:" "new-window -n '%%' -c '#{pane_current_path}'"
unbind c

# Navigation
bind a select-pane -L
bind s select-pane -D
bind d select-pane -R
bind w select-pane -U
bind -n S-Left previous-window
bind -n S-Right next-window

# Floating terminal
bind f display-popup -E -w 60% -h 60% -d "#{pane_current_path}" "TMUX_POPUP=1 exec $SHELL"

# Detach / Close
bind q detach-client
bind x confirm-before -p "Kill pane? (y/n)" kill-pane

# Copy mode
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# Sessions
bind r display-popup -E -w 30% -h 30% "sess=$(tmux list-sessions -F '#{session_name}' | fzf --reverse) && tmux switch-client -t \"$sess\""
bind R command-prompt -p "Create new session:" "new-session -s '%%'"

# Reload
bind c source-file ~/.tmux.conf \; display "Config reloaded"

# Status bar
set -g status-position bottom
set -g status-interval 5
set -g status-style "#{?client_prefix,bg=#3a3a3a fg=#ffcb83,bg=#333333 fg=#ffcb83}"
set -g status-left-length 30
set -g status-left "#[fg=#fb5d00 bold]#S "
set -g window-status-format "#[fg=#9a8a70] #W "
set -g window-status-current-format "#[fg=#ffcb83 bold] #{?window_zoomed_flag,ï€‚ ,}#W "
set -g window-status-separator ""
set -g status-right-length 50
set -g status-right ""

# Pane borders
set -g pane-border-style "fg=#6a4e29"
set -g pane-active-border-style "fg=#fb5d00"

# Messages
set -g message-style "bg=#333333,fg=#ffcb83"
set -g message-command-style "bg=#333333,fg=#ffcb83"

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'

# Keep at bottom
run '~/.tmux/plugins/tpm/tpm'
